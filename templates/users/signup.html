{% extends "base/base.html" %}
{% load static %}

{% block title %}ثبت نام | زیما{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/users_signup.css' %}">
{% endblock %}

{% block content %}
<section class="auth-section">
    <div class="auth-container">
        <div class="auth-wrapper">
            <!-- Form Section -->
            <div class="auth-form-section">
                <div class="form-header">
                    <h2 class="form-title">عضویت در زیما</h2>
                    <p class="form-subtitle">اطلاعات خود را برای شروع وارد کنید</p>
                </div>

                <form class="auth-form" method="post" action="{% url 'users:signup' %}">
                    {% csrf_token %}

                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}

                    <div class="form-group">
                        <label for="id_username" class="form-label">نام کاربری</label>
                        <div style="position: relative;">
                            <input type="text"
                                name="username"
                                id="id_username"
                                class="form-input {% if form.username.errors %}is-invalid{% endif %}"
                                value="{{ form.username.value|default:'' }}"
                                placeholder="نام کاربری خود را انتخاب کنید"
                                required
                                autocomplete="username"> {# ✅ اضافه شد #}
                            <i class="fas fa-user input-icon"></i>
                        </div>
                        {% if form.username.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.username.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="id_email" class="form-label">ایمیل</label>
                        <div style="position: relative;">
                            <input type="email"
                                name="email"
                                id="id_email"
                                class="form-input {% if form.email.errors %}is-invalid{% endif %}"
                                value="{{ form.email.value|default:'' }}"
                                placeholder="ایمیل خود را وارد کنید"
                                required
                                autocomplete="email"> {# ✅ اضافه شد #}
                            <i class="fas fa-envelope input-icon"></i>
                        </div>
                        {% if form.email.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.email.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="id_phone_number" class="form-label">شماره موبایل</label>
                        <div style="position: relative;">
                            <input type="text"
                                name="phone_number"
                                id="id_phone_number"
                                class="form-input {% if form.phone_number.errors %}is-invalid{% endif %}"
                                value="{{ form.phone_number.value|default:'' }}"
                                placeholder="09xxxxxxxxx"
                                required
                                autocomplete="tel"> {# ✅ اضافه شد #}
                            <i class="fas fa-mobile-alt input-icon"></i>
                        </div>
                        {% if form.phone_number.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.phone_number.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="id_password1" class="form-label">رمز عبور</label>
                        <div style="position: relative;">
                            <input type="password"
                                name="password1"
                                id="id_password1"
                                class="form-input {% if form.password1.errors %}is-invalid{% endif %}"
                                placeholder="رمز عبور قوی انتخاب کنید"
                                required
                                autocomplete="new-password"> {# ✅ اضافه شد #}
                            <button type="button" class="password-toggle" onclick="togglePassword('id_password1')">
                                <i class="fas fa-eye" id="id_password1_icon"></i>
                            </button>
                        </div>
                        <div class="password-strength" id="password1Strength" style="display: none;">
                            <div class="strength-bar">
                                <div class="strength-fill" id="strengthFill1"></div>
                            </div>
                            <span id="strengthText1"></span>
                        </div>
                        {% if form.password1.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.password1.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="id_password2" class="form-label">تکرار رمز عبور</label>
                        <div style="position: relative;">
                            <input type="password"
                                name="password2"
                                id="id_password2"
                                class="form-input {% if form.password2.errors %}is-invalid{% endif %}"
                                placeholder="رمز عبور را دوباره وارد کنید"
                                required
                                autocomplete="new-password"> {# ✅ اضافه شد #}
                            <button type="button" class="password-toggle" onclick="togglePassword('id_password2')">
                                <i class="fas fa-eye" id="id_password2_icon"></i>
                            </button>
                        </div>
                        {% if form.password2.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.password2.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-check">
                        <input type="checkbox" name="terms" id="id_terms" class="form-check-input" required>
                        <label for="id_terms" class="form-check-label">
                            قوانین و مقررات را می‌پذیرم
                            <a href="#" onclick="openTermsModal(event)">مشاهده قوانین و مقررات</a> {# ✅ تغییر: تابع JS جدید #}
                        </label>
                    </div>

                    <button type="submit" class="btn-auth" id="submitBtn">عضویت در زیما</button>

                    <div class="form-divider">
                        <span>یا</span>
                    </div>

                    <div class="auth-switch">
                        <p class="auth-switch-text">قبلاً عضو شده‌اید؟</p>
                        <a href="{% url 'users:login' %}" class="btn-switch">ورود به حساب</a>
                    </div>
                </form>
            </div>

            <!-- Visual Section -->
            <div class="auth-visual">
                <div class="visual-content">
                    <h1 class="welcome-title">به زیما خوش آمدید</h1>
                    <p class="welcome-subtitle">دنیای زیبایی و راحتی را کشف کنید. عضویت در زیما تجربه‌ای منحصربه‌فرد از خرید آنلاین است.</p>

                    <ul class="signup-benefits">
                        <li>
                            <i class="fas fa-gem"></i>
                            <span>دسترسی به کالکشن‌های ویژه</span>
                        </li>
                        <li>
                            <i class="fas fa-percentage"></i>
                            <span>تخفیف‌های اختصاصی اعضا</span>
                        </li>
                        <li>
                            <i class="fas fa-shipping-fast"></i>
                            <span>ارسال سریع و رایگان</span>
                        </li>
                        <li>
                            <i class="fas fa-heart"></i>
                            <span>ذخیره محصولات موردعلاقه</span>
                        </li>
                        <li>
                            <i class="fas fa-headset"></i>
                            <span>پشتیبانی اختصاصی ۲۴/۷</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>

{# ✅ جدید: مودال قوانین و مقررات - این بخش را قبل از {% endblock content %} اضافه کنید #}
<div class="terms-modal-overlay" id="termsModal">
    <div class="terms-modal-content">
        <button class="terms-modal-close" onclick="closeTermsModal()">
            <i class="fas fa-times"></i>
        </button>
        <h2>قوانین و مقررات زیما</h2>
        <p>
            به فروشگاه آنلاین زیما خوش آمدید. با استفاده از خدمات ما، شما با شرایط و ضوابط زیر موافقت می‌کنید. لطفاً آن‌ها را به دقت مطالعه فرمایید.
        </p>

        <h3>۱. حفظ حریم خصوصی و اطلاعات کاربر</h3>
        <ul>
            <li>
                **محرمانه بودن اطلاعات:** تمامی مشخصات و اطلاعات شخصی کاربران (شامل نام، نام خانوادگی، آدرس ایمیل، شماره تماس، آدرس پستی و سابقه خرید) نزد زیما کاملاً **محرمانه** است و تحت هیچ شرایطی به اشخاص ثالث ارائه، فروخته یا اجاره داده نمی‌شود.
            </li>
            <li>
                **استفاده از اطلاعات:** اطلاعات جمع‌آوری شده از شما صرفاً برای مقاصد زیر مورد استفاده قرار می‌گیرد:
                <ul>
                    <li>**پردازش و ارسال سفارشات:** برای اطمینان از تحویل صحیح و به موقع محصولات خریداری شده.</li>
                    <li>**ارتباطات مرتبط با سفارش:** ارسال ایمیل‌ها یا پیامک‌های مربوط به وضعیت سفارش، تأییدیه خرید، کد رهگیری و به‌روزرسانی‌ها.</li>
                    <li>**ارسال یا دریافت ایمیل:** استفاده از آدرس ایمیل شما برای ارسال خبرنامه‌ها، اطلاع‌رسانی‌ها در مورد محصولات جدید، تخفیف‌های ویژه یا پیشنهادات شخصی‌سازی شده (در صورتی که شما به دریافت آن‌ها رضایت داده باشید) و همچنین پاسخ به ایمیل‌های ارسالی از سوی شما.</li>
                    <li>**بهبود تجربه کاربری:** تحلیل داده‌های ناشناس برای بهبود عملکرد وب‌سایت، محصولات و خدمات ما.</li>
                </ul>
            </li>
            <li>
                **امنیت داده‌ها:** زیما از پروتکل‌های امنیتی پیشرفته و رمزنگاری (SSL/TLS) برای حفاظت از اطلاعات شما در حین انتقال و ذخیره‌سازی استفاده می‌کند.
            </li>
        </ul>

        <h3>۲. شرایط عمومی</h3>
        <ul>
            <li>
                **عضویت:** برای استفاده کامل از امکانات سایت و ثبت سفارش، ایجاد حساب کاربری الزامی است. شما مسئول حفظ محرمانه بودن رمز عبور خود هستید.
            </li>
            <li>
                **اطلاعات صحیح:** کاربر موظف است در هنگام ثبت نام و ثبت سفارش، اطلاعات صحیح، کامل و به‌روز را وارد کند. در صورت ورود اطلاعات نادرست، زیما مسئولیتی در قبال مشکلات احتمالی نخواهد داشت.
            </li>
            <li>
                **سن قانونی:** استفاده از خدمات سایت برای افراد زیر 18 سال، با نظارت والدین یا قیم قانونی امکان‌پذیر است.
            </li>
        </ul>

        <h3>۳. قوانین خرید و پرداخت</h3>
        <ul>
            <li>
                **قیمت‌گذاری:** تمامی قیمت‌ها به تومان بوده و شامل مالیات بر ارزش افزوده (در صورت لزوم) می‌باشند. زیما حق تغییر قیمت‌ها را در هر زمان محفوظ می‌دارد.
            </li>
            <li>
                **پرداخت:** پرداخت تنها از طریق درگاه‌های پرداخت آنلاین معتبر و امن امکان‌پذیر است. زیما هیچ‌گونه اطلاعات کارت بانکی شما را ذخیره نمی‌کند.
            </li>
            <li>
                **موجودی کالا:** موجودی کالا در سایت به صورت لحظه‌ای به‌روزرسانی می‌شود، اما در موارد نادر، ممکن است پس از ثبت سفارش، موجودی محصول به اتمام رسیده باشد. در این صورت، مبلغ پرداخت شده به شما بازگردانده خواهد شد.
            </li>
        </ul>

        <h3>۴. شرایط ارسال و تحویل</h3>
        <ul>
            <li>
                **روش‌های ارسال:** اطلاعات مربوط به روش‌های ارسال، زمان تحویل و هزینه‌ها در صفحه "شرایط ارسال" به تفصیل توضیح داده شده است.
            </li>
            <li>
                **پیگیری سفارش:** پس از ارسال، کد رهگیری پستی برای شما ارسال می‌شود و می‌توانید وضعیت سفارش خود را پیگیری کنید.
            </li>
        </ul>

        <h3>۵. ضمانت بازگشت و تعویض کالا</h3>
        <ul>
            <li>
                **شرایط بازگشت:** جزئیات کامل در مورد شرایط، مراحل و هزینه‌های بازگشت یا تعویض کالا در صفحه "سیاست بازگشت کالا" موجود است.
            </li>
            <li>
                **موارد بهداشتی:** به دلیل رعایت مسائل بهداشتی، محصولات لباس زیر (مانند شورت) و اقلامی که مستقیماً با بدن در تماس بوده‌اند، **تحت هیچ شرایطی قابل بازگشت یا تعویض نیستند.**
            </li>
        </ul>

        <h3>۶. حقوق و مسئولیت‌ها</h3>
        <ul>
            <li>
                **مالکیت معنوی:** تمامی محتوای سایت (شامل تصاویر، متون، طراحی‌ها و لوگو) متعلق به زیما است و هرگونه کپی‌برداری بدون اجازه کتبی ممنوع است.
            </li>
            <li>
                **مسئولیت کاربر:** کاربر مسئول تمامی فعالیت‌های انجام شده با حساب کاربری خود است و موظف به رعایت قوانین جمهوری اسلامی ایران در هنگام استفاده از سایت می‌باشد.
            </li>
        </ul>

        <h3>۷. تغییرات در قوانین</h3>
        <p>
            زیما حق دارد در هر زمان، قوانین و مقررات خود را به‌روزرسانی یا تغییر دهد. هرگونه تغییر در این صفحه اطلاع‌رسانی خواهد شد. توصیه می‌شود به صورت دوره‌ای این صفحه را برای اطلاع از آخرین تغییرات مطالعه فرمایید.
        </p>

        <p style="text-align: center; margin-top: 30px; font-weight: 600; color: var(--primary-color);">
            با تشکر از اعتماد و همراهی شما، تیم زیما 🌸
        </p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Password toggle functionality
    window.togglePassword = function(inputId) {
        const input = document.getElementById(inputId);
        const icon = document.getElementById(inputId + '_icon');

        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    };

    // Password strength checker
    const password1Input = document.getElementById('id_password1');
    const strengthDiv = document.getElementById('password1Strength');
    const strengthFill = document.getElementById('strengthFill1');
    const strengthText = document.getElementById('strengthText1');

    password1Input.addEventListener('input', function() {
        const password = this.value;
        const strength = checkPasswordStrength(password);

        if (password.length > 0) {
            strengthDiv.style.display = 'block';
            strengthFill.className = 'strength-fill strength-' + strength.level;
            strengthText.textContent = strength.text;
        } else {
            strengthDiv.style.display = 'none';
        }
    });

    function checkPasswordStrength(password) {
        let score = 0;
        let feedback = [];

        if (password.length >= 8) score++;
        else feedback.push('حداقل ۸ کاراکتر');

        if (/[a-z]/.test(password)) score++;
        else feedback.push('حروف کوچک');

        if (/[A-Z]/.test(password)) score++;
        else feedback.push('حروف بزرگ');

        if (/[0-9]/.test(password)) score++;
        else feedback.push('اعداد');

        if (/[^A-Za-z0-9]/.test(password)) score++;
        else feedback.push('کاراکترهای خاص');

        const levels = ['weak', 'fair', 'good', 'strong'];
        const texts = ['ضعیف', 'متوسط', 'خوب', 'قوی'];

        let level, text;
        if (score <= 1) {
            level = 'weak';
            text = 'ضعیف - ' + feedback.slice(0, 2).join(', ');
        } else if (score <= 2) {
            level = 'fair';
            text = 'متوسط - ' + feedback.slice(0, 1).join(', ');
        } else if (score <= 3) {
            level = 'good';
            text = 'خوب';
        } else {
            level = 'strong';
            text = 'قوی';
        }

        return { level, text };
    }

    // Password confirmation check
    const password2Input = document.getElementById('id_password2');
    password2Input.addEventListener('input', function() {
        if (this.value && this.value !== password1Input.value) {
            this.classList.add('is-invalid');
            this.classList.remove('is-valid');
        } else if (this.value) {
            this.classList.add('is-valid');
            this.classList.remove('is-invalid');
        }
    });

    // Input validation and styling
    const inputs = document.querySelectorAll('.form-input');
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            if (this.value.trim()) {
                this.classList.add('is-valid');
                this.classList.remove('is-invalid');
            } else {
                this.classList.remove('is-valid', 'is-invalid');
            }
        });

        input.addEventListener('blur', function() {
            if (this.hasAttribute('required') && !this.value.trim()) {
                this.classList.add('is-invalid');
                this.classList.remove('is-valid');
            }
        });
    });

    // Phone number formatting
    const phoneInput = document.getElementById('id_phone_number');
    phoneInput.addEventListener('input', function() {
        let value = this.value.replace(/\D/g, '');
        if (value.startsWith('98')) {
            value = value.substring(2);
        }
        if (value.startsWith('0')) {
            value = value.substring(1);
        }
        if (value.length > 0) {
            value = '09' + value.substring(1, 10);
        }
        this.value = value;
    });

    // Auto-hide alerts after 5 seconds
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => {
        setTimeout(() => {
            alert.style.opacity = '0';
            alert.style.transform = 'translateY(-10px)';
            setTimeout(() => alert.remove(), 300);
        }, 5000);
    });

    // ✅ جدید: توابع مودال قوانین و مقررات
    window.openTermsModal = function(event) {
        event.preventDefault();
        const modal = document.getElementById('termsModal');
        if (modal) {
            modal.classList.add('active');
            document.body.style.overflow = 'hidden'; // جلوگیری از اسکرول صفحه اصلی
        }
    };

    window.closeTermsModal = function() {
        const modal = document.getElementById('termsModal');
        if (modal) {
            modal.classList.remove('active');
            document.body.style.overflow = ''; // بازگرداندن اسکرول صفحه اصلی
        }
    };

    // بستن مودال با کلید Escape
    document.addEventListener('keydown', function(e) {
        const modal = document.getElementById('termsModal');
        if (e.key === 'Escape' && modal && modal.classList.contains('active')) {
            closeTermsModal();
        }
    });

    // بستن مودال با کلیک روی پس‌زمینه
    const modalOverlay = document.getElementById('termsModal');
    if (modalOverlay) {
        modalOverlay.addEventListener('click', function(e) {
            if (e.target === modalOverlay) {
                closeTermsModal();
            }
        });
    }
});
</script>
{% endblock %}
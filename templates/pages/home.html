{% extends "base/base.html" %}
{% load static %}
{% load currency_filters %} {# تغییر: اضافه کردن لود فیلترهای ارز #}
{% load my_custom_filters %} {# این خط را اضافه کنید #}

{% block title %}زیما | زیبایی خصوصی شما{% endblock %}
{% block body_class %}animated-bg-page{% endblock %} {# ✅ این خط اضافه شد #}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/pages/home.css' %}">
    <style>
        /* Sparkle Effect */
        .sparkle {
            position: fixed;
            width: 6px;
            height: 6px;
            background: var(--secondary-color);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1000;
            animation: sparkleAnim 1s ease-out forwards;
        }

        @keyframes sparkleAnim {
            0% {
                opacity: 1;
                transform: scale(0);
            }
            50% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0);
            }
        }
    </style>
{% endblock %}
{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="hero-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="hero-container">
        <div class="hero-content">
            <div class="hero-badge">
                <i class="fas fa-sparkles"></i>
                کالکشن جدید زمستان
            </div>
            <h1 class="hero-title">
                زیبایی <span class="highlight">خصوصی</span><br>
                شما را کشف کنید
            </h1>
            <p class="hero-description">
                مجموعه‌ای منحصربه‌فرد از لباس‌های زیر که احساس زیبایی و اعتماد به نفس را در شما بیدار می‌کند
            </p>
            <div class="hero-cta">
                <a href="{% url 'products:list' %}" class="btn btn-primary">
                    <span>کشف کالکشن</span>
                    <i class="fas fa-arrow-left"></i>
                </a>
                <a href="#" class="btn btn-secondary">
                    <i class="fas fa-play"></i>
                    <span>تماشای ویدیو</span>
                </a>
            </div>
        </div>

        <div class="hero-image">
            {# شما باید این تصویر را در static/images/zima_theme/ قرار دهید #}
            <img src="{% static 'images/zima.jpg' %}" alt="کالکشن زیما" class="hero-img">
            <div class="floating-elements">
                <div class="floating-element">
                    <i class="fas fa-star" style="color: var(--gold-accent); font-size: 1.5rem;"></i>
                </div>
                <div class="floating-element">
                    <i class="fas fa-heart" style="color: var(--coral); font-size: 1.2rem;"></i>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- ==================================================== -->
<!-- == Family Collections Showcase Section == -->
<!-- ==================================================== -->
<section class="family-showcase fade-in">
    <div class="container">
        <div class="section-header">
            <span class="section-badge">برای تمام خانواده</span>
            <h2 class="section-title">کلکسیون‌های <span class="script">منتخب</span> ما</h2>
            <p class="section-description">محصولات ما برای هر عضو خانواده شما با دقت و عشق طراحی شده‌اند.</p>
        </div>

        <div class="family-content">
            <!-- ✅ تصویر/ویدیو اصلی خانواده (کادر بالا) -->
            <div class="family-media-container" id="familyMediaContainer">
    <!-- ✅ لایه پس‌زمینه محو شده -->
    <div class="family-background-blur" id="familyBackgroundBlur"></div>

    <!-- ✅ لایه overlay زیبا -->
    <div class="family-overlay"></div>

    <!-- تصویر پیش‌فرض خانواده -->
    <img src="{% static 'images/family/family-main.jpg' %}"
         alt="خانواده زیما"
         class="family-main-image active"
         id="familyMainImage">

    <!-- ویدیوهای مخصوص هر عضو -->
    <video class="family-video"
           id="dadVideo"
           muted
           preload="metadata"
           data-member="dad">
        <source src="{% static 'videos/family/dad-animation.mp4' %}" type="video/mp4">
    </video>

    <video class="family-video"
           id="momVideo"
           muted
           preload="metadata"
           data-member="mom">
        <source src="{% static 'videos/family/mom-animation.mp4' %}" type="video/mp4">
    </video>

    <video class="family-video"
           id="boyVideo"
           muted
           preload="metadata"
           data-member="boy">
        <source src="{% static 'videos/family/boy-animation.mp4' %}" type="video/mp4">
    </video>

    <video class="family-video"
           id="girlVideo"
           muted
           preload="metadata"
           data-member="girl">
        <source src="{% static 'videos/family/girl-animation.mp4' %}" type="video/mp4">
    </video>
</div>

            <!-- ✅ آیتم‌های انتخاب (همان شکل قبلی) -->
            <div class="family-grid">
                <a href="#" class="family-collection-card"
                   data-member="dad"
                   onmouseenter="playFamilyVideo('dad')"
                   onmouseleave="stopFamilyVideo()">
                    <img src="{% static 'images/family/men-category.jpg' %}" alt="کلکسیون مردانه">
                    <div class="card-overlay"><h3>مردانه</h3></div>
                </a>
                <a href="#" class="family-collection-card"
                   data-member="mom"
                   onmouseenter="playFamilyVideo('mom')"
                   onmouseleave="stopFamilyVideo()">
                    <img src="{% static 'images/family/women-category.jpg' %}" alt="کلکسیون زنانه">
                    <div class="card-overlay"><h3>زنانه</h3></div>
                </a>
                <a href="#" class="family-collection-card"
                   data-member="boy"
                   onmouseenter="playFamilyVideo('boy')"
                   onmouseleave="stopFamilyVideo()">
                    <img src="{% static 'images/family/boys-category.jpg' %}" alt="کلکسیون پسرانه">
                    <div class="card-overlay"><h3>پسرانه</h3></div>
                </a>
                <a href="#" class="family-collection-card"
                   data-member="girl"
                   onmouseenter="playFamilyVideo('girl')"
                   onmouseleave="stopFamilyVideo()">
                    <img src="{% static 'images/family/girls-category.jpg' %}" alt="کلکسیون دخترانه">
                    <div class="card-overlay"><h3>دخترانه</h3></div>
                </a>
            </div>
        </div>
    </div>
</section>
<!-- Collections Section -->
<section class="collections fade-in">
    <div class="section-header">
        <div class="section-badge">کالکشن‌های ویژه</div>
        <h2 class="section-title">
            سه دنیای <span class="script">زیبایی</span>
        </h2>
        <p class="section-description">
            هر کالکشن داستانی از زیبایی، راحتی و اعتماد به نفس را روایت می‌کند
        </p>
    </div>

    <div class="collections-grid">
        {# توجه: این بخش به بک‌اند متصل شده. شما باید دسته‌بندی‌هایی با این اسلاگ‌ها بسازید #}
        <div class="collection-card fade-in">
            <a href="{% url 'products:category_list' 'classic-chic' %}" class="text-decoration-none">
                <img src="{% static 'images/zima_theme/collection-classic.jpg' %}" alt="کلاسیک" class="collection-image">
                <div class="collection-content">
                    <h3 class="collection-title">کلاسیک و شیک</h3>
                    <p class="collection-description">مجموعه‌ای از طراحی‌های کلاسیک که هرگز از مد نمی‌افتد</p>
                    <div class="collection-link">
                        مشاهده کالکشن <i class="fas fa-arrow-left"></i>
                    </div>
                </div>
            </a>
        </div>

        <div class="collection-card fade-in">
            <a href="{% url 'products:category_list' 'romantic-beautiful' %}" class="text-decoration-none">
                <img src="{% static 'images/zima_theme/collection-romantic.jpg' %}" alt="رمانتیک" class="collection-image">
                <div class="collection-content">
                    <h3 class="collection-title">رمانتیک و زیبا</h3>
                    <p class="collection-description">طراحی‌های رمانتیک برای لحظات خاص زندگی شما</p>
                    <div class="collection-link">
                        مشاهده کالکشن <i class="fas fa-arrow-left"></i>
                    </div>
                </div>
            </a>
        </div>

        <div class="collection-card fade-in">
            <a href="{% url 'products:category_list' 'sporty-comfortable' %}" class="text-decoration-none">
                <img src="{% static 'images/zima_theme/collection-sporty.jpg' %}" alt="اسپرت" class="collection-image">
                <div class="collection-content">
                    <h3 class="collection-title">اسپرت و راحت</h3>
                    <p class="collection-description">راحتی و سبکی برای زندگی پر انرژی شما</p>
                    <div class="collection-link">
                        مشاهده کالکشن <i class="fas fa-arrow-left"></i>
                    </div>
                </div>
            </a>
        </div>
    </div>
</section>

<!-- Featured Products -->
<section class="featured-slider fade-in"> {# کلاس جدید برای این بخش #}
    <div class="container">
        <div class="section-header">
            <div class="section-badge">محبوب‌ترین‌ها</div>
            <h2 class="section-title">
                پرفروش‌ترین <span class="script">محصولات</span>
            </h2>
            <p class="section-description">
                مجموعه‌ای از پرفروش‌ترین محصولات زیما با طراحی خاص و کیفیت بی‌نظیر.
            </p>
        </div>
        <div class="text-center mt-5">
                <a href="{% url 'products:list' %}" class="btn btn-primary btn-view-all-featured-slider"> {# فعلاً به صفحه لیست محصولات می‌رود #}
                    <span>مشاهده همه محصولات ویژه</span>
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
        {% if featured_products %}
            <div class="slider-container">
                <button class="slider-nav-arrow prev-slide" aria-label="اسلاید قبلی">
                    <i class="fas fa-chevron-right"></i> {# آیکون راست برای قبلی (جهت RTL) #}
                </button>

                <div class="products-slider-track">
                    {% for product_chunk in featured_products|batch:5 %} {# محصولات را به گروه‌های 5 تایی تقسیم می‌کند #}
                        <div class="product-slide {% if forloop.first %}active{% endif %}">
                            <div class="products-grid-slider"> {# گرید برای 5 محصول #}
                                {% for product in product_chunk %}
                                    <div class="product-card-slider fade-in">
                                        <a href="{{ product.get_absolute_url }}" class="product-link-slider">
                                            <div class="product-image-wrapper-slider">
                                                {% with main_image=product.get_main_image %}
                                                    <img src="{% if main_image %}{{ main_image.image.url }}{% else %}{% static 'images/zima_theme/product-placeholder.jpg' %}{% endif %}"
                                                         alt="{{ product.name }}"
                                                         class="product-image-slider">
                                                {% endwith %}
                                                <div class="product-badges-slider">
                                                    {% if product.is_new %}
                                                        <span class="badge-slider new">جدید</span>
                                                    {% endif %}
                                                    {% if product.has_discount %}
                                                        <span class="badge-slider sale">{{ product.discount_percent }}% تخفیف</span>
                                                    {% endif %}
                                                    {% if product.is_featured %}
                                                        <span class="badge-slider featured">ویژه</span>
                                                    {% endif %}
                                                </div>
                                                <div class="product-actions-hover-slider">
                                                    <button class="action-btn-slider quick-view-btn" onclick="event.preventDefault(); openQuickView('{{ product.id }}')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="action-btn-slider wishlist-btn {% if product.is_favorited %}active{% endif %}" onclick="event.preventDefault(); toggleWishlist(this, '{{ product.id }}')">
                                                        <i class="fa{% if product.is_favorited %}s{% else %}r{% endif %} fa-heart"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </a>
                                        <div class="product-info-slider">
                                            <a href="{{ product.get_absolute_url }}" class="product-name-link-slider">
                                                <h3 class="product-name-slider">{{ product.name }}</h3>
                                            </a>
                                            <div class="product-meta-slider">
                                                <span class="product-brand-slider">{{ product.brand }}</span>
                                                <div class="product-rating-slider">
                                                    <div class="stars-slider">
                                                        {% with rating=product.get_average_rating|default:0 %}
                                                            {% for i in "12345" %}
                                                                <i class="fa{% if forloop.counter <= rating %}s{% else %}r{% endif %} fa-star star-slider"></i>
                                                            {% endfor %}
                                                        {% endwith %}
                                                    </div>
                                                    <span class="rating-count-slider">({{ product.get_rating_count|default:0 }})</span>
                                                </div>
                                            </div>
                                            <div class="product-price-slider">
                                                {% if product.has_discount %}
                                                    <span class="price-original-slider">{{ product.get_formatted_price }}</span>
                                                    <span class="price-current-slider">{{ product.get_formatted_display_price }}</span>
                                                {% else %}
                                                    <span class="price-current-only-slider">{{ product.get_formatted_display_price }}</span>
                                                {% endif %}
                                            </div>
                                            <a href="{{ product.get_absolute_url }}" class="btn-detail-slider">
                                                <i class="fas fa-arrow-left"></i>
                                                مشاهده جزئیات
                                            </a>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <button class="slider-nav-arrow next-slide" aria-label="اسلاید بعدی">
                    <i class="fas fa-chevron-left"></i> {# آیکون چپ برای بعدی (جهت RTL) #}
                </button>
            </div>


        {% else %}
            <div class="empty-state-slider">
                <i class="fas fa-box-open"></i>
                <h3>محصول ویژه‌ای برای نمایش وجود ندارد.</h3>
                <p>به زودی محصولات جدیدی اضافه خواهد شد.</p>
            </div>
        {% endif %}
    </div>
</section>

<!-- Testimonials -->
<section class="testimonials fade-in">
    <div class="testimonials-container">
        <div class="section-header">
            <div class="section-badge">نظرات مشتریان</div>
            <h2 class="section-title">
                آنچه <span class="script">مشتریان</span> می‌گویند
            </h2>
        </div>
        <div class="testimonials-slider">
            <div class="testimonial-card">
                <p class="testimonial-text">کیفیت محصولات زیما واقعاً فوق‌العاده است. راحتی و زیبایی در کنار هم. من عاشق این برند شدم!</p>
                <div class="testimonial-author">
                    <div class="author-avatar">س</div>
                    <div class="author-info">
                        <h4>سارا احمدی</h4>
                        <p>مشتری وفادار</p>
                    </div>
                </div>
            </div>
            <div class="testimonial-card">
                <p class="testimonial-text">خرید من از زیما تجربه‌ای بی‌نظیر بود. از کیفیت تا خدمات پس از فروش، همه چیز عالی!</p>
                <div class="testimonial-author">
                    <div class="author-avatar">م</div>
                    <div class="author-info">
                        <h4>مریم نوری</h4>
                        <p>مشتری جدید</p>
                    </div>
                </div>
            </div>
            <div class="testimonial-card">
                <p class="testimonial-text">پس از سال‌ها جستجو، بالاخره برندی پیدا کردم که هم راحت باشد هم زیبا. ممنون زیما!</p>
                <div class="testimonial-author">
                    <div class="author-avatar">ن</div>
                    <div class="author-info">
                        <h4>نیلوفر رضایی</h4>
                        <p>مشتری راضی</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const navLinks = document.querySelectorAll('.family-nav-link');
    const focusImages = document.querySelectorAll('.family-member-focus');
    const familyVisuals = document.querySelector('.family-visuals');

    navLinks.forEach(link => {
        link.addEventListener('mouseenter', () => {
            const memberName = link.dataset.member;

            focusImages.forEach(img => {
                if (img.dataset.member === memberName) {
                    img.classList.add('active');
                } else {
                    img.classList.remove('active');
                }
            });
        });
    });

    familyVisuals.addEventListener('mouseleave', () => {
        // وقتی موس از کل کادر تصویر خارج شد، همه هاله‌ها محو شوند
        focusImages.forEach(img => {
            img.classList.remove('active');
        });
    });
});
</script>
<script>
    // تابع افزودن به سبد خرید برای صفحه اصلی (فقط نمایش Toast)
    function addToCartHome(productId) {
        showLoading();
        // در اینجا می‌توانید یک درخواست AJAX واقعی برای افزودن به سبد خرید ارسال کنید.
        // برای سادگی فعلا فقط یک Toast نمایش داده می‌شود.
        setTimeout(() => {
            hideLoading();
            showToast('محصول به سبد خرید اضافه شد', 'check');
            // در اینجا می‌توانید تعداد آیتم‌های سبد خرید در هدر را به‌روز کنید
            // مثلاً: updateCartBadge();
        }, 1000);
    }

    // Testimonials Auto Scroll
    const testimonialSlider = document.querySelector('.testimonials-slider');
    if (testimonialSlider) {
        let testimonialScrollAmount = 0;
        setInterval(() => {
            // عرض هر کارت + فاصله بین آن‌ها (350px + 40px)
            testimonialScrollAmount += 390;
            if (testimonialScrollAmount >= testimonialSlider.scrollWidth - testimonialSlider.clientWidth) {
                testimonialScrollAmount = 0; // بازگشت به ابتدا
            }
            testimonialSlider.scrollTo({
                left: testimonialScrollAmount,
                behavior: 'smooth'
            });
        }, 4000);
    }
</script>
{% endblock %}